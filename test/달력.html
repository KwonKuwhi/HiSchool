<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Custom Calendar</title>
  <link rel="stylesheet" href="./달력.css">
</head>
<style>

</style>

<body>

  <header class="header">
    <nav class="navbar">
      <div class="menu-icon">☰</div>
      <h1 class="logo">일정</h1>
      <div class="settings-icon">⚙</div>
    </nav>
  </header>

  <div class="sec_cal">
    <div class="cal_nav">
      <a href="javascript:;" class="nav-btn go-prev">prev</a>
      <div class="year-month"></div>
      <a href="javascript:;" class="nav-btn go-next">next</a>
    </div>
    <div class="cal_wrap">
      <div class="days">
        <div class="day">MON</div>
        <div class="day">TUE</div>
        <div class="day">WED</div>
        <div class="day">THU</div>
        <div class="day">FRI</div>
        <div class="day">SAT</div>
        <div class="day">SUN</div>
      </div>
      <div class="dates"></div>

      <!-- 하단 작성 내용추가 -->

      <div class="schdules-box">
        <button id="openBtn" class="btn">일정보기</button>
        <div class="list-additional">
          <div class="list-additional-main"> </div>
        </div>
        <button id="closeBtn" class="btn">닫기</button>
      </div>


    </div>
  </div>






  <!-- 전체 화면 모달 창 -->
  <div class="fullscreen-modal">
    <div class="fullscreen-modal-content">
      <span class="close-fullscreen-modal">×</span>
      <div class="list">
        <div class="list-title">제목</div>
        <input type="text" class="dateInput-title" placeholder="제목을 입력하세요">
        <div class="list-content">내용</div>
        <input type="text" class="dateInput-content" placeholder="내용을 입력하세요">
      </div>
      <button id="submitDate">확인</button>
    </div>
  </div>


  <script>
    const fullscreenModal = document.querySelector('.fullscreen-modal');
    const dateInputTitle = document.querySelector('.dateInput-title');
    const dateInputContent = document.querySelector('.dateInput-content');


    let thisMonth;
    let selectedDate;
    let schedules = []; // 일정을 저장할 배열


    function toggleSchedulesBox(displayStyle) {
      const listAdditional = document.querySelector('.list-additional');
      listAdditional.style.display = displayStyle;
    }

    // "open" 버튼 이벤트 리스너
    // "오픈" 버튼 이벤트 리스너
    document.getElementById('openBtn').addEventListener('click', function () {

      document.querySelector('.list-additional').style.display = 'grid'; // 그리드로 표시
      document.getElementById('closeBtn').style.display = 'block'; // "클로즈" 버튼을 보이게 함
    });

    // "클로즈" 버튼 이벤트 리스너
    document.getElementById('closeBtn').addEventListener('click', function () {
      document.querySelector('.list-additional').style.display = 'none'; // 숨김
      this.style.display = 'none'; // "클로즈" 버튼도 숨김
    });





    // 더블 클릭 이벤트 처리
    document.querySelector('.dates').addEventListener('dblclick', function (e) {
      if (e.target.classList.contains('current')) {
        const clickedDate = e.target.textContent;

        // 더블 클릭 시 전체 화면 모달 열기
        fullscreenModal.style.display = 'flex';

        // 모달 창에 선택한 날짜 표시
        // dateInputTitle.value = clickedDate;
      }
    });


    let selectedDateString; // 선택된 날짜를 저장할 전역 변수

    document.querySelector('.dates').addEventListener('click', function (e) {
      if (e.target.classList.contains('current')) {
        // 선택된 날짜가 이미 있으면 그 날짜의 선택을 해제
        if (selectedDate) {
          selectedDate.classList.remove('selected');
        }

        // 새로 클릭한 날짜를 선택
        selectedDate = e.target;
        selectedDate.classList.add('selected');

        // 모달에 날짜 표시
        const selectedDateString = `${thisMonth.getFullYear()}-${thisMonth.getMonth() + 1}-${selectedDate.textContent}`;
      }
    });




    // 전체 화면 모달 창 닫기
    document.querySelector('.close-fullscreen-modal').addEventListener('click', function () {
      fullscreenModal.style.display = 'none';
    });




    // 확인 버튼 클릭 하단 영역에 제목 내용 출력
    document.getElementById('submitDate').addEventListener('click', function () {
      const title = dateInputTitle.value;
      const content = dateInputContent.value;

      if (title && content) {
        schedules.push({ date: title, title, content });
        updateScheduleList();

        fullscreenModal.style.display = 'none';
        dateInputTitle.value = '';
        dateInputContent.value = '';
      } else {
        alert('제목, 내용, 날짜를 모두 입력하세요.');
      }
    });

    // 일정 목록 업데이트 함수
    function updateScheduleList() {
      const listAdditional = document.querySelector('.list-additional');
      listAdditional.innerHTML = ''; // 기존 목록 초기화

      schedules.forEach(schedule => {
        let divMain = document.createElement('div');
        divMain.className = 'list-additional-main';

        let divTitle = document.createElement('div');
        divTitle.className = 'list-additional-title';
        divTitle.textContent = schedule.title;

        let divContent = document.createElement('div');
        divContent.className = 'list-additional-content';
        divContent.textContent = schedule.content;

        let divinfo = document.createElement('div');
        divinfo.className = 'additional-info';
        divinfo.textContent = `날짜`; // 저장된 날짜 표시

        divMain.appendChild(divTitle);
        divMain.appendChild(divContent);
        divMain.appendChild(divinfo); // divinfo를 divMain 안에 추가
        listAdditional.appendChild(divMain);
      });
    }


    // 페이지 로드 시 달력 초기화
    calendarInit();

    function calendarInit() {
      // 날짜 정보 가져오기
      const date = new Date(); // 현재 날짜(로컬 기준) 가져오기
      const utc = date.getTime() + (date.getTimezoneOffset() * 60 * 1000); // uct 표준시 도출
      const kstGap = 9 * 60 * 60 * 1000; // 한국 kst 기준시간 더하기
      const today = new Date(utc + kstGap); // 한국 시간으로 date 객체 만들기(오늘)

      thisMonth = new Date(today.getFullYear(), today.getMonth(), today.getDate()); // 달력에서 표기하는 날짜 객체

      // 캘린더 렌더링
      renderCalendar(thisMonth);

      function renderCalendar(thisMonth) {
        // 렌더링을 위한 데이터 정리

        // 이전 달의 마지막 날 날짜와 요일 구하기
        const startDay = new Date(thisMonth.getFullYear(), thisMonth.getMonth(), 0);
        const prevDate = startDay.getDate();
        const prevDay = startDay.getDay();

        // 이번 달의 마지막날 날짜와 요일 구하기
        const endDay = new Date(thisMonth.getFullYear(), thisMonth.getMonth() + 1, 0);
        const nextDate = endDay.getDate();
        const nextDay = endDay.getDay();

        // 현재 월 표기
        document.querySelector('.year-month').textContent = `${thisMonth.getFullYear()}.${thisMonth.getMonth() + 1}`;

        // 렌더링 html 요소 생성
        const calendar = document.querySelector('.dates');
        calendar.innerHTML = '';

        // 지난달
        for (let i = prevDate - prevDay + 1; i <= prevDate; i++) {
          calendar.innerHTML += `<div class="day prev disable">${i}</div>`;
        }
        // 이번달
        for (let i = 1; i <= nextDate; i++) {
          calendar.innerHTML += `<div class="day current">${i}</div>`;
        }
        // 다음달
        for (let i = 1; i <= (7 - nextDay == 7 ? 0 : 7 - nextDay); i++) {
          calendar.innerHTML += `<div class="day next disable">${i}</div>`;
        }

        // 오늘 날짜 표기
        if (today.getMonth() === thisMonth.getMonth()) {
          const todayDate = today.getDate();
          const currentMonthDate = document.querySelectorAll('.dates .current');
          currentMonthDate[todayDate - 1].classList.add('today');
        }
      }

      // 이전달로 이동
      document.querySelector('.go-prev').addEventListener('click', function () {
        thisMonth.setMonth(thisMonth.getMonth() - 1);
        renderCalendar(thisMonth);
        // 선택된 날짜 초기화
        selectedDate = null;
      });


      // 다음달로 이동
      document.querySelector('.go-next').addEventListener('click', function () {
        thisMonth.setMonth(thisMonth.getMonth() + 1);
        renderCalendar(thisMonth);
        // 선택된 날짜 초기화
        selectedDate = null;
      });
    }
  </script>
</body>

</html>